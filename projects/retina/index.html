<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Retinal Fundus Image Enhancement With Image Decomposition | Dibyajyoti Jena</title>
<meta property="og:title" content="Retinal Fundus Image Enhancement With Image Decomposition | Dibyajyoti Jena" />
<meta name="twitter:title" content="Retinal Fundus Image Enhancement With Image Decomposition | Dibyajyoti Jena" />
<meta itemprop="name" content="Retinal Fundus Image Enhancement With Image Decomposition | Dibyajyoti Jena" />
<meta name="application-name" content="Retinal Fundus Image Enhancement With Image Decomposition | Dibyajyoti Jena" />
<meta property="og:site_name" content="Awesome hugo blog" />

<meta name="description" content="Minimal Hugo blog theme with light and dark mode support">
<meta itemprop="description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta property="og:description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta name="twitter:description" content="Minimal Hugo blog theme with light and dark mode support" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />



  <meta itemprop="image" content="https://coolman-spaceman.github.io/" />
  <meta property="og:image" content="https://coolman-spaceman.github.io/" />
  <meta name="twitter:image" content="https://coolman-spaceman.github.io/" />
  <meta name="twitter:image:src" content="https://coolman-spaceman.github.io/" />




  <meta name="generator" content="Hugo 0.92.2" />

  

  <link rel="canonical" href="https://coolman-spaceman.github.io/projects/retina/"><link href="/sass/main.min.0eebb6db90b4ec9f4444ef402f08421ee056025ba860df3d749a9f299d472008.css" rel="stylesheet"><link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

  

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="manifest" href="/images/favicon/site.webmanifest">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/images/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="/images/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  
  <link rel="icon" type="image/svg+xml" href="/images/favicon/favicon.svg">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

    </head><body data-theme = "dark" class="notransition">
<script src="https://coolman-spaceman.github.io/js/themeLoader.min.0ea9375d525d6f19779c6d41cfaf9e166e47014d9734ff071daad3a4ff12d147.js"></script><div class="navbar" role="navigation">
  <nav class="menu" aria-label="Main Navigation">
    <a href="/" class="logo">
      <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
    </a>
    <input type="checkbox" id="menu-trigger" class="menu-trigger" />
    <label for="menu-trigger">
      <span class="menu-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
      </span>
    </label>

    <div class="trigger">
      <ul class="trigger-container">
        
        
          <li>
            <a 
            class="menu-link "
            href="/">
            Home
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link "
            href="/posts/">
            Posts
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link active"
            href="/projects/">
            Projects
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link "
            href="/publications/">
            Publications
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link "
            href="/lectures/">
            All Lin. Algebra
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link "
            href="/paint/">
            Art Stuff
            </a>
            
          </li>
        
          <li>
            <a 
            class="menu-link "
            href="/about/">
            About
            </a>
            
          </li>
        
        <li class="menu-separator">
          <span>|</span>
        </li>
      </ul>
      <a id="mode" href="#">
        <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
        <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
      </a>
    </div>
  </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Retinal Fundus Image Enhancement With Image Decomposition</h1>
                
                <div class="post-meta">
                    <time datetime="2024-06-21T19:12:48&#43;05:30" itemprop="datePublished"> Jun 21, 2024 </time>
                </div>
            </header>
            <div class="page-content">
                <p>Retinal fundus photography is a non-invasive method to check for symptoms and other features related to diseases like diabetic retinopathy, age-related macular degeneration, cardiovascular disease. The main features to look out for are the vascular structure, lesions, optic disc, microaneurysms, etc. These depend on high quality fundus images to be processed properly. However, many such images are clinically unsatisfactory because of human error and electronic noise in the imaging instrument. The main problems are: <strong>non-uniform illumination</strong>, <strong>low contrast</strong> and <strong>noise</strong>.</p>
<p>Some common image enhancement methods are Histogram Equalization(HE) and Contrast Limited Adaptive Histogram Equalization(CLAHE). HE is performed over the entire imageâ€™s histogram and thus works over the entire contrast, rendering it in-effective for fundus image enhancements, where the contrast improvement requirements are regional. CLAHE performs better in this regard, because it can suppress noise in near-constant regions. Illumination correction happens simultaneously in this step. However, the individual color layers can still be enhanced more.</p>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/01_test.png" width="300">
<img class=scaled src="/projectimages/retina/01_clahe.png" width="300">
</div>
<figcaption>Raw fundus image and CLAHE applied</figcaption>
</figure>
<h2 id="proposed-method">Proposed Method</h2>
<p>In the CLAHE method, there is significant improvement in contrast, because of which
vasculature of the fundus images becomes very clear. But there are still some dark spots
and blobs, showing uneven illumination.
The method used in this project uses a global noise estimation based image decomposition method to divide the input image into three layers, i.e., the <strong>base</strong>, <strong>detail</strong>, and <strong>noise</strong> layers. Then the <strong>base layer is corrected in HSV space</strong>, <strong>detail layer is enhanced</strong> and then they are combined back. <strong>Noise layer is rejected</strong>.</p>
<h3>Image Decomposition</h3>
<p>Total variation based structure decomposition method is used to separate the image into high frequency and low frequency parts. The high frequency part can be thought of containing noise and/or details and the low frequency part is the base and/or structure.</p>
<p>There are two decomposition steps:</p>
<blockquote>
<p>Image $\rightarrow$ Structure and Noise</p>
</blockquote>
<blockquote>
<p>Structure $\rightarrow$ Base and Detail</p>
</blockquote>
<h4>First decomposition</h4>
<p>The input image is a combination of noise and structure layers.
\begin{equation}
I^c(x,y) = I^c_{noise}(x,y) + I^c_{structure}(x,y), c \in (R,G,B)
\end{equation}</p>
<p>Noise corresponds to high frequency. TV decomposition method employs a cost function minimization to remove the high frequency layer:</p>
<p>\begin{equation}
I^c_{structure}(x,y) = arg min_I \sum_{x,y}^{}\left [ (I(x,y)-I^c(x,y))^2 + \lambda^c\Delta I(x,y) \right ]
\end{equation}</p>
<p>In the above equation there are two terms. The first term is called the <strong>variation term</strong>:
which is simply the squared difference between $I(x,y)$ and the input image. The 2nd term
is called the <strong>regularisation term</strong>, which corresponds to the gradient of I.
The physical significance is that, to minimize both terms, the output needs to be as <strong>close
to the input as possible but should not have high frequency edges</strong>. Regularisation term $\lambda_c$
corresponds to the degree of smoothness required for the operation, over every color layer
in R, G, B.</p>
<p>So for the first step, equations 1 and 2 are followed. $\lambda_c$ is calculated for each color layer
$I_c$ from the following equation:</p>
<p>\begin{equation}
\lambda^c = \sqrt{\pi/2}\frac{1}{6(W-2)(H-2)}\sum_{x,y}^{}\left | (I^c\star N_s)(x,y) \right |
\end{equation}</p>
<p>\begin{equation}
N_s =    \begin{bmatrix}
1 &amp; -2 &amp; 1\\
-2 &amp; 4 &amp;-2\\
1 &amp;-2  &amp; 1\\
\end{bmatrix}
\end{equation}</p>
<p>W and H correspond to width and height of the image and c refers to each color layer
R,G,B. Figure 1 shows the results of input image decomposition into structure layer and
noise layer. Scikit-Image provides an inbult function to implement TV decomposition and
the same has been used in this process.</p>
<h4> 2nd decomposition</h4>
<p>Moving on to the 2nd step of decomposition, the same method is used. But this time, the practical value of $\lambda $ is kept constant for all layers at 0.3.</p>
<p>\begin{equation}
I^c_{structure}(x,y) = I^c_{base}(x,y) + I^c_{details}(x,y), c \in (R,G,B)
\end{equation}</p>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/01_base.png" width="200">
<img class=scaled src="/projectimages/retina/01_detail.png" width="200">
<img class=scaled src="/projectimages/retina/01_noise.png" width="200">
</div>
<figcaption>Base Layer, Detail Layer and Noise layer respectively. Base layer's lumination is corrected, detail layer is enhanced. Noise is discarded. </figcaption>
</figure>
<h3>Base lumination correction</h4>
<p>For illuminant correction, first the RGB space is converted to HSV space and V layer is extracted as luminance information, denoted as $L_{in}(x,y)$.
Correction is done by the following equation, where n is the contrast enhancement parameter. It is set to 1 for all experiments given.
\begin{equation}
L_{out} = \frac{L_{in}^n}{L_{in}^n+\sigma_g^n}
\end{equation}
Visual adaptation level is determined by $\sigma_g$,which is a
global adaptation level estimated from the whole luminance image from the equation below:
\begin{equation}
\sigma_g = \frac{M_g}{1+exp(S_g)}
\end{equation}
where $M_g$ and $S_g$ are the mean and standard deviation of the entire $L_{in}$ respectively.
Finally, corrected base is found out by transferring the HSV space back to RGB space.</p>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/01_base.png" width="300">
<img class=scaled src="/projectimages/retina/01_base_new.png" width="300">
</div>
<figcaption>Base Layer and lumination corrected base </figcaption>
</figure>
<h4>Detail Layer Enhancement</h4>
<p><strong>Red</strong> and <strong>Green</strong> detail layers are passed through a Gaussian filter, keeping in mind that a Gaussian filter is essentially a low pass filter and it will somewhat blur the edges of the veins, making them thicker and more prominent, while removing other noise and artefacts. The execution of the next step differs a bit from the original reference paper. <strong>Blue</strong> layer does not carry much information and hence is not used.</p>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/01_red.png" width="200">
<img class=scaled src="/projectimages/retina/01_green.png" width="200">
<img class=scaled src="/projectimages/retina/01_blue.png" width="200">
<img class=scaled src="/projectimages/retina/01_detail.png" width="300">
<img class=scaled src="/projectimages/retina/01_detail_new.png" width="300">
</div>
<figcaption>First Row: RGB detail layers</figcaption>
<figcaption>Second Row: Old detail layer, New enhanced detail layer</figcaption>
</figure>
<p>The enhanced detail layers are merged with the corresponding base layers to form the final output according to the equation:
\begin{equation}
I_{out}^c = I_{correct-base}^c + \alpha^c I_{enhance-details}^c
\end{equation}</p>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/01_base_new.png" width="200">
<img class=scaled src="/projectimages/retina/01_detail_new.png" width="200">
<img class=scaled src="/projectimages/retina/01_output.png" width="200">
</div>
<figcaption>Corrected base merged with enhanced detail layer to give output</figcaption>
</figure>
<p>The output is clearly much better than CLAHE visually.</p>
<h2>Some more examples for different images, and outputs compared against CLAHE</h2>
<figure>
 <div class="column">
    <p align="center">
<img class=scaled src="/projectimages/retina/03_test.png" width="200">
<img class=scaled src="/projectimages/retina/03_clahe.png" width="200">
<img class=scaled src="/projectimages/retina/03_output.png" width="200">
<img class=scaled src="/projectimages/retina/04_test.png" width="200">
<img class=scaled src="/projectimages/retina/04_clahe.png" width="200">
<img class=scaled src="/projectimages/retina/04_output.png" width="200">
<img class=scaled src="/projectimages/retina/07_test.png" width="200">
<img class=scaled src="/projectimages/retina/07_clahe.png" width="200">
<img class=scaled src="/projectimages/retina/07_output.png" width="200">
<img class=scaled src="/projectimages/retina/14_test.png" width="200">
<img class=scaled src="/projectimages/retina/14_clahe.png" width="200">
<img class=scaled src="/projectimages/retina/14_output.png" width="200">
</div>
<figcaption>First column: Original images</figcaption>
<figcaption>Second column: CLAHE corrected images</figcaption>
<figcaption>Third column: Proposed results</figcaption>
</figure>
<p>The code for the project will be uploaded on Github very soon!</p>

            </div>
        </article>
    </main>
</div>
<footer class="footer">
    

    <div class="footer_social-icons">
<a href="https://github.com/coolman-spaceman" target="_blank" rel="noopener noreferrer me" title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://www.linkedin.com/in/coolman-spaceman/" target="_blank" rel="noopener noreferrer me" title="Linkedin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a></div>
    
</footer>
<script src="https://coolman-spaceman.github.io/js/themeSwitchnMenu.min.f2fa3aed078bf5a7b612bf5548ddd0cb9891199ed24b5b673465df221e70bf4c.js"></script></body>
</html>
